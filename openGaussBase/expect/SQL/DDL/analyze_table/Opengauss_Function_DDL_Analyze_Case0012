-- @testpoint: 统计更新带索引的表
drop table if exists analyze_005;
SQL SUCCESS
create table analyze_005(id int,name clob,num int);
SQL SUCCESS
create index INDEX_005 ON analyze_005(id,num);
SQL SUCCESS
insert into analyze_005 values(1,'xxxxx',2);
SQL SUCCESS
insert into analyze_005 values(3,'yyyyy',4);
SQL SUCCESS
select * from analyze_005;
+----+-------+-----+
| id | name  | num |
+----+-------+-----+
| 1  | xxxxx | 2   |
| 3  | yyyyy | 4   |
+----+-------+-----+
analyze analyze_005((id,name));
SQL SUCCESS
analyze analyze_005;
SQL SUCCESS
select * from pg_statistic where starelid = (select oid from pg_class where relname = 'analyze_005');
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
| starelid | starelkind | staattnum | stainherit | stanullfrac | stawidth | stadistinct | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | staop3 | staop4 | staop5 | stanumbers1 | stanumbers2 | stanumbers3 | stanumbers4 | stanumbers5 | stavalues1    | stavalues2 | stavalues3 | stavalues4 | stavalues5 | stadndistinct | staextinfo |
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
?.*| c          | 1         | false      | 0.0         | 4        | -1.0        | 2        | 3        | 0        | 0        | 0        | 97     | 97     | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{1,3\}         |            |            |            |            | 0.0           |            |
?.*| c          | 2         | false      | 0.0         | 6        | -1.0        | 2        | 3        | 0        | 0        | 0        | 664    | 664    | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{xxxxx,yyyyy\} |            |            |            |            | 0.0           |            |
?.*| c          | 3         | false      | 0.0         | 4        | -1.0        | 2        | 3        | 0        | 0        | 0        | 97     | 97     | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{2,4\}         |            |            |            |            | 0.0           |            |
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
alter table analyze_005 rename column id to ids;
SQL SUCCESS
analyze analyze_005;
SQL SUCCESS
select * from pg_statistic where starelid = (select oid from pg_class where relname = 'analyze_005');
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
| starelid | starelkind | staattnum | stainherit | stanullfrac | stawidth | stadistinct | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | staop3 | staop4 | staop5 | stanumbers1 | stanumbers2 | stanumbers3 | stanumbers4 | stanumbers5 | stavalues1    | stavalues2 | stavalues3 | stavalues4 | stavalues5 | stadndistinct | staextinfo |
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
?.*| c          | 1         | false      | 0.0         | 4        | -1.0        | 2        | 3        | 0        | 0        | 0        | 97     | 97     | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{1,3\}         |            |            |            |            | 0.0           |            |
?.*| c          | 2         | false      | 0.0         | 6        | -1.0        | 2        | 3        | 0        | 0        | 0        | 664    | 664    | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{xxxxx,yyyyy\} |            |            |            |            | 0.0           |            |
?.*| c          | 3         | false      | 0.0         | 4        | -1.0        | 2        | 3        | 0        | 0        | 0        | 97     | 97     | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{2,4\}         |            |            |            |            | 0.0           |            |
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
alter table analyze_005 drop column ids;
SQL SUCCESS
analyze analyze_005;
SQL SUCCESS
select * from pg_statistic where starelid = (select oid from pg_class where relname = 'analyze_005');
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
| starelid | starelkind | staattnum | stainherit | stanullfrac | stawidth | stadistinct | stakind1 | stakind2 | stakind3 | stakind4 | stakind5 | staop1 | staop2 | staop3 | staop4 | staop5 | stanumbers1 | stanumbers2 | stanumbers3 | stanumbers4 | stanumbers5 | stavalues1    | stavalues2 | stavalues3 | stavalues4 | stavalues5 | stadndistinct | staextinfo |
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
?.*| c          | 2         | false      | 0.0         | 6        | -1.0        | 2        | 3        | 0        | 0        | 0        | 664    | 664    | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{xxxxx,yyyyy\} |            |            |            |            | 0.0           |            |
?.*| c          | 3         | false      | 0.0         | 4        | -1.0        | 2        | 3        | 0        | 0        | 0        | 97     | 97     | 0      | 0      | 0      |             | \{1.0\}       |             |             |             | \{2,4\}         |            |            |            |            | 0.0           |            |
+----------+------------+-----------+------------+-------------+----------+-------------+----------+----------+----------+----------+----------+--------+--------+--------+--------+--------+-------------+-------------+-------------+-------------+-------------+---------------+------------+------------+------------+------------+---------------+------------+
drop table if exists analyze_005;
SQL SUCCESS
